# SLAM Arena Mission (LiDAR Mapping + Yellow Boundary Detection)

## Goal
This run starts `slam_toolbox`, flies the drone to `4.0 m`, maps the arena with onboard LiDAR, and uses both front and belly cameras to detect yellow boundary lines during mapping.

## 1) Start Gazebo Arena
Open terminal 1:

```bash
cd /home/kunal/Desktop/drone
HOME=/tmp gz sim -r worlds/arena.sdf
```

## 2) Start SLAM + Bridge + Mission + Map Window
Open terminal 2:

```bash
cd /home/kunal/Desktop/drone
source /opt/ros/jazzy/setup.bash
HOME=/tmp ros2 launch /home/kunal/Desktop/drone/launch/slam_arena_mission.launch.py
```

This launch starts:
- `ros_gz_bridge` with topic bridges from `config/arena_bridge_topics.yaml`
- `slam_toolbox` async mapping using `config/slam_toolbox_arena.yaml`
- mission node `scripts/slam_boundary_mapping_mission.py`
- RViz map window (another window)

## 3) What the Mission Does
1. Waits for odometry, LiDAR scan, and both camera streams.
2. Enables velocity control.
3. Takes off from base `(0,0)` to `4.0 m`.
4. For each movement segment, briefly hovers, yaws to face travel direction (front camera aligned), then translates.
5. Follows a mapping waypoint sweep of the arena at `4.0 m`.
6. Detects yellow boundary lines from both cameras (HSV filtering).
7. If yellow boundaries are detected, performs inward boundary-avoidance motion.
8. Returns to `(0,0)` at `4.0 m`, hovers for `2 s`, descends slowly to `2.0 m`, holds `2 s`, then lands slowly.

## 4) Key ROS Topics
- `/scan` (LiDAR, used by SLAM)
- `/odom` (odometry)
- `/front_camera/image_raw` and `/down_camera/image_raw`
- `/cmd_vel` (mission velocity commands)
- `/drone_enable` (controller enable)
- `/map` (generated by `slam_toolbox`, visible in RViz)

## 5) Optional
Disable RViz map window if needed:

```bash
cd /home/kunal/Desktop/drone
source /opt/ros/jazzy/setup.bash
HOME=/tmp ros2 launch /home/kunal/Desktop/drone/launch/slam_arena_mission.launch.py use_rviz:=false
```

## 6) View and Save the Built Map
While the mission is running, RViz shows the live map (`/map` topic).

To save the map after mapping:

```bash
mkdir -p /home/kunal/Desktop/drone/maps
source /opt/ros/jazzy/setup.bash
ros2 run nav2_map_server map_saver_cli -f /home/kunal/Desktop/drone/maps/arena_map --ros-args -p map_subscribe_transient_local:=true
```

This writes:
- `/home/kunal/Desktop/drone/maps/arena_map.yaml`
- `/home/kunal/Desktop/drone/maps/arena_map.pgm`
