# SLAM Arena Mission (LiDAR Mapping + Yellow Boundary Detection)

## Goal
This run starts `slam_toolbox`, flies the drone to `4.0 m`, maps the arena with onboard LiDAR, and uses both front and belly cameras to detect yellow boundary lines during mapping. The mission now uses a faster mapping profile with precision slowdown near waypoints and a live mission dashboard.

## 1) Start Gazebo Arena
Open terminal 1:

```bash
cd /home/kunal/Desktop/drone
HOME=/tmp gz sim -r worlds/arena.sdf
```

## 2) Start SLAM + Bridge + Mission + Map Window
Open terminal 2:

```bash
cd /home/kunal/Desktop/drone
source /opt/ros/jazzy/setup.bash
HOME=/tmp ros2 launch /home/kunal/Desktop/drone/launch/slam_arena_mission.launch.py
```

This launch starts:
- `ros_gz_bridge` with topic bridges from `config/arena_bridge_topics.yaml`
- `slam_toolbox` async mapping using `config/slam_toolbox_arena.yaml`
- mission node `scripts/slam_boundary_mapping_mission.py`
- RViz map window (another window)

## 3) What the Mission Does
1. Waits for odometry, LiDAR scan, and both camera streams.
2. Enables velocity control.
3. Takes off from base `(0,0)` to `4.0 m`.
4. For each movement segment, the mission yaws first and only translates when heading-aligned; autonomous translation is forward-only, so the front camera stays at ~0 degrees to movement direction.
5. Flies from base to a mapping corner, then performs a boundary-aligned straight-line sweep (lane-by-lane), shifting slightly after each lane and repeating across the arena, with faster cruise speed (`~1.35 m/s` max) and automatic slowdown near waypoints for precision (`~0.45 m/s` min near target).
6. Detects yellow boundary lines from both cameras (HSV filtering).
7. Uses belly-camera yellow pixels to generate an opposite-direction repulsion vector (stronger yellow occupancy => stronger push).
8. Draws that repulsion vector as a red arrow in the belly camera debug window.
9. Boundary guard uses that proximity signal to trigger a short hover, align heading, and then retreat inward (inward-biased) so the drone stays inside the yellow boundary.
10. Shows a live mission dashboard window with battery estimate, current speed, distance from base pad, and coverage progress.
11. If GUI is not available, dashboard metrics are still logged once per second as `[Dashboard] battery=... speed=... dist_base=... phase=...`.
12. Returns to `(0,0)` at `4.0 m`, hovers for `2 s`, descends slowly to `2.0 m`, holds `2 s`, then lands slowly.

## 4) Key ROS Topics
- `/scan` (LiDAR, used by SLAM)
- `/odom` (odometry)
- `/front_camera/image_raw` and `/down_camera/image_raw`
- `/cmd_vel` (mission velocity commands)
- `/drone_enable` (controller enable)
- `/map` (generated by `slam_toolbox`, visible in RViz)
- `/manual_mode` and `/manual_cmd_vel` (manual override)

## 5) Optional
Disable RViz map window if needed:

```bash
cd /home/kunal/Desktop/drone
source /opt/ros/jazzy/setup.bash
HOME=/tmp ros2 launch /home/kunal/Desktop/drone/launch/slam_arena_mission.launch.py use_rviz:=false
```

## 6) Quick Validation
Run the project checks:

```bash
cd /home/kunal/Desktop/drone
scripts/run_full_checks.sh
scripts/run_full_checks.sh --integration
```

## 7) View and Save the Built Map
While the mission is running, RViz shows the live map (`/map` topic).

To save the map after mapping:

```bash
mkdir -p /home/kunal/Desktop/drone/maps
source /opt/ros/jazzy/setup.bash
ros2 run nav2_map_server map_saver_cli -f /home/kunal/Desktop/drone/maps/arena_map --ros-args -p map_subscribe_transient_local:=true
```

This writes:
- `/home/kunal/Desktop/drone/maps/arena_map.yaml`
- `/home/kunal/Desktop/drone/maps/arena_map.pgm`

Note:
- Dashboard battery is an onboard estimate derived from motion and motor load, not hardware battery telemetry.
